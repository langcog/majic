---
title: "MAJIC Baseline Visit Computer Tasks"
author: "Mike Frank"
date: "Sept 28, 2015"
output: 
  html_document:
    toc: true
    number_sections: true
---

<style type="text/css">
body, td {
   font-size: 14px;
}
code {
  font-size: 11px;
}
pre {
  font-size: 11px;
}
</style>


```{r include=FALSE}
# knitr settings to control how R chunks work.
require(knitr)
opts_chunk$set(
  cache=FALSE,
  warn=FALSE,
  error=FALSE,
  size="small"    # slightly smaller font for code
)
```

```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(langcog)
library(magrittr)
library(stringr)

rm(list=ls())
theme_set(theme_bw())
```

# Cognitive tasks

Read data. Note that there is one sitting file for the battery and one for each of the sub-tests, in case the battery crashed and failed to save data for that participant.

```{r}
sittings.raw <- bind_rows(
  read_csv("data/fall 2015/b301_09.28.15_14.56.34_sittings.csv"),
  read_csv("data/fall 2015/b299_09.28.15_18.57.40_sittings.csv"),
  read_csv("data/fall 2015/b300_09.28.15_18.57.49_sittings.csv"),
  read_csv("data/fall 2015/b302_09.28.15_18.57.55_sittings.csv"))

sittings <- sittings.raw %>% 
  mutate(subid = str_trim(toupper(misc), side = "both"),
         sitting_id = id) %>%
  filter(str_detect(subid, "[Ss][12]-")) %>%
  mutate(grade = ifelse(str_detect(subid, "[Ss][1]"), 
                        "first grade", 
                        "second grade")) %>%
  select(subid, sitting_id, grade, battery_id, test_order, num_completed) 

gonogo.raw <- bind_rows(read_csv("data/fall 2015/b301_t463_09.28.15_00.36.59.csv"),
                        read_csv("data/fall 2015/b299_t463_09.28.15_18.57.41.csv"))
ravens.raw <- bind_rows(read_csv("data/fall 2015/b301_t464_09.28.15_00.36.59.csv"),
                        read_csv("data/fall 2015/b300_t464_09.28.15_18.57.50.csv"))
swm.raw <- bind_rows(read_csv("data/fall 2015/b301_t467_09.28.15_00.37.00.csv"),
                     read_csv("data/fall 2015/b302_t467_09.28.15_18.57.56.csv"))
```

## Go / No-Go Task

```{r}
gonogo <- gonogo.raw %>%
  filter(sitting_id %in% sittings$sitting_id) %>%
  left_join(sittings, by = "sitting_id") %>%
  select(subid, grade, trial, stim, correct, rt, accuracy, responseAssign, rtCall)
```

Accuracy.

```{r}
gonogo.summary <- gonogo %>%
  group_by(subid, grade) %>%
  summarise(accuracy = mean(accuracy, na.rm=TRUE))
  
ms <- gonogo.summary %>%
  group_by(grade) %>%
  summarise(accuracy = mean(accuracy))

gonogo.summary %>%
  ggplot(aes(x=accuracy)) + 
  geom_histogram(binwidth = .05) +
  facet_grid(.~grade) + 
  geom_vline(xintercept = .5, lty = 3) +
  xlim(c(0,1)) + 
  geom_vline(data = ms, aes(xintercept = accuracy), 
             col = "red", lty = 2)

```

RT.

```{r}
ms <- gonogo %>%
  filter(rt > 0 & accuracy == 1) %>%
  group_by(subid, grade) %>%
  summarise(rt = mean(rt, na.rm=TRUE)) %>%
  group_by(grade) %>%
  summarise(rt = mean(rt))

gonogo %>%
  filter(rt > 0 & accuracy == 1) %>%
  group_by(subid, grade) %>%
  summarise(rt = mean(rt, na.rm=TRUE)) %>%
  ggplot(aes(x=rt)) + 
  geom_histogram(binwidth = 50) +
  facet_grid(.~grade) + 
  geom_vline(data = ms, aes(xintercept = rt), 
             col = "red", lty = 2)
```

## Spatial WM

Data processing. 

```{r}
swm <- swm.raw %>%
  filter(sitting_id %in% sittings$sitting_id,
         type == "test") %>%
  left_join(sittings, by = "sitting_id") %>%
  filter(type == "test") %>%
  select(subid, grade, trial, capacity, correct)
  
```

Mean level (same measure as in Zenith study). 

```{r}
swm.summary <- swm %>%
  group_by(subid, grade) %>%
  summarise(capacity = mean(capacity, na.rm=TRUE))
  
ms <- swm.summary %>%
  group_by(grade) %>%
  summarise(capacity = mean(capacity))
  
swm.summary %>%
  ggplot(aes(x=capacity)) + 
  geom_histogram(binwidth = .5) +
  facet_grid(.~grade) +
  xlim(c(1,8)) +
  geom_vline(data = ms, aes(xintercept = capacity), 
             col = "red", lty = 2)
```

## Raven's 

Actually a matrix reasoning equivalent.

```{r}
ravens <- ravens.raw %>%
  filter(sitting_id %in% sittings$sitting_id,
         type == "test") %>%
  left_join(sittings, by = "sitting_id") %>%
  filter(type == "test") %>%
  select(subid, grade, trial, correct)
  
```

Mean level (same measure as in Zenith study). 

```{r}
ravens.summary <- ravens %>% 
  group_by(subid, grade) %>%
    summarise(correct = sum(correct, na.rm=TRUE))

ms <- ravens.summary %>%
  group_by(grade) %>%
  summarise(correct = mean(correct))
  
ravens.summary %>%
  ggplot(aes(x=correct)) + 
  geom_histogram(binwidth = 1) +
  facet_grid(.~grade) +
  geom_vline(data = ms, aes(xintercept = correct), 
             col = "red", lty = 2)
```

## Individuals

```{r}
subs <- ravens.summary %>% 
  left_join(gonogo.summary) %>%
  left_join(swm.summary) %>%
  rename(ravens = correct, 
         gonogo = accuracy,
         swm = capacity) %>%
  filter(!is.na(ravens) & !is.na(gonogo) & !is.na(swm))

subs
```

Correlation plot. 

```{r}
ggcorplot(subs %>% select(ravens, gonogo, swm))
```

Correlations.

```{r}
kable(cor(subs %>% ungroup %>% select(ravens, gonogo, swm)), digits = 2)

cor.test(subs$ravens, subs$gonogo)
cor.test(subs$ravens, subs$swm)
cor.test(subs$gonogo, subs$swm)
```

# Math tasks

Read in data. 

```{r}
pv <- read.csv("data/fall 2015/2015_PVNumerals.csv") %>%
  select(subnum, pvAvg) %>%
  rename(subid = subnum)
wg <- read.csv("data/fall 2015/2015_WGArith.csv") %>%
  select(subnum, arithmeticTotal, arithmeticAverage) %>%
  rename(subid = subnum)
wj <- read.csv("data/fall 2015/2015_WOODCOCK.csv") %>%
  select(subnum, woodcockTotal) %>%
  rename(subid = subnum)
```

Merge with sub data. 

```{r}
d <- left_join(subs, pv) %>% 
  left_join(wg) %>% 
  left_join(wj)
```

Now plot each task individually. 

## Place value.

```{r}
pv.summary <- d %>% 
  group_by(subid, grade) %>%
    summarise(correct = sum(pvAvg, na.rm=TRUE))

ms <- pv.summary %>%
  group_by(grade) %>%
  summarise(correct = mean(correct))
  
pv.summary %>%
  ggplot(aes(x=correct)) + 
  geom_histogram(binwidth = .1) +
  facet_grid(.~grade) +
  geom_vline(data = ms, aes(xintercept = correct), 
             col = "red", lty = 2) + 
  ggtitle("Place Value Accuracy") + 
  xlab("Proportion correct")
```

## Arithmetic

```{r}
wg.summary <- d %>% 
  group_by(subid, grade) %>%
    summarise(correct = sum(arithmeticTotal, na.rm=TRUE))

ms <- wg.summary %>%
  group_by(grade) %>%
  summarise(correct = mean(correct))
  
wg.summary %>%
  ggplot(aes(x=correct)) + 
  geom_histogram(binwidth = 1) +
  facet_grid(.~grade) +
  geom_vline(data = ms, aes(xintercept = correct), 
             col = "red", lty = 2) + 
  ggtitle("Arithmetic Accuracy") + 
  xlab("Total Problems Correct")
```

## Woodcock-Johnson III

```{r}
wj.summary <- d %>% 
  group_by(subid, grade) %>%
    summarise(correct = sum(woodcockTotal, na.rm=TRUE))

ms <- wj.summary %>%
  group_by(grade) %>%
  summarise(correct = mean(correct))
  
wj.summary %>%
  ggplot(aes(x=correct)) + 
  geom_histogram(binwidth = 1) +
  facet_grid(.~grade) +
  geom_vline(data = ms, aes(xintercept = correct), 
             col = "red", lty = 2) + 
  ggtitle("Woodcock-Johnson III Accuracy") + 
  xlab("Total Problems Correct")
```

## Relations between math measures

Plots. 

```{r}
ggcorplot(d %>% select(woodcockTotal, arithmeticTotal, pvAvg))
```

Correlations.

```{r}
kable(cor(d %>% ungroup %>% 
            select(woodcockTotal, arithmeticTotal, pvAvg)), digits = 2)

cor.test(d$woodcockTotal, d$arithmeticTotal)
cor.test(d$woodcockTotal, d$pvAvg)
cor.test(d$arithmeticTotal, d$pvAvg)
```

# Relations between all measures.

```{r}
kable(cor(d %>% ungroup %>% 
            select(ravens, gonogo, swm, 
                   woodcockTotal, arithmeticTotal, pvAvg)), digits = 2)

cor.test(d$ravens, d$woodcockTotal)
cor.test(d$ravens, d$arithmeticTotal)
cor.test(d$ravens, d$pvAvg)

cor.test(d$swm, d$woodcockTotal)
cor.test(d$swm, d$arithmeticTotal)
cor.test(d$swm, d$pvAvg)

cor.test(d$gonogo, d$woodcockTotal)
cor.test(d$gonogo, d$arithmeticTotal)
cor.test(d$gonogo, d$pvAvg)
```